syntax = "proto3";

package booking.v1;

service BookingService {
  rpc CreateReservation (CreateReservationRequest) returns (CreateReservationResponse);
  rpc ConfirmBooking (ConfirmBookingRequest) returns (ConfirmBookingResponse);
  rpc GetUserBookings (GetUserBookingsRequest) returns (GetUserBookingsResponse);

  rpc ListReservedSeats (ListReservedSeatsRequest) returns (ListReservedSeatsResponse);
}

message SeatInput {
  string seat_id = 1;    
  int32 price = 2;     
}

message CreateReservationRequest {
  string user_id = 1;
  string screening_id = 2;
  repeated SeatInput seats = 3;
  int32 hold_minutes = 4; 
}

message CreateReservationResponse {
  string order_id = 1;        
  repeated string ticket_ids = 2;
  int64 expires_At = 3;      
  int32 amount = 4;      
}

message ConfirmBookingRequest {
  string booking_id = 1;
  string user_id = 2;
}

message ConfirmBookingResponse {
  bool ok = 1;
}

message GetUserBookingsRequest {
  string user_id = 1;
}

message GetUserBookingsResponse {
  repeated BookingItem bookings = 1;
}

message ListReservedSeatsRequest {
  string hall_id = 1;
  string screening_id = 2;
}

message ListReservedSeatsResponse {
  bool ok = 1;
  repeated string reserved_seat_ids = 2;
}

message BookingSeatInfo {
  string seat_id = 1;
}

message BookingMovieInfo {
  string id = 1;
  string title = 2;
  string poster = 3;
}

message BookingTheaterInfo {
  string id = 1;
  string name = 2;
}

message BookingHallInfo {
  string id = 1;
  string name = 2;
}

message BookingItem {
  string id = 1;
  BookingMovieInfo movie = 2;
  BookingTheaterInfo theater = 3;
  BookingHallInfo hall = 4;
  repeated BookingSeatInfo seats = 5;
  string qr_code = 6;
}