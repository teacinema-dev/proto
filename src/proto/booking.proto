syntax = "proto3";

package booking.v1;

service BookingService {
  rpc GetUserBookings (GetUserBookingsRequest) returns (GetUserBookingsResponse);
  rpc CreateReservation (CreateReservationRequest) returns (CreateReservationResponse);
  rpc ConfirmBooking (ConfirmBookingRequest) returns (ConfirmBookingResponse);
  rpc CancelBooking (CancelBookingRequest) returns (CancelBookingResponse);

  rpc ListReservedSeats (ListReservedSeatsRequest) returns (ListReservedSeatsResponse);
}

message GetUserBookingsRequest {
  string user_id = 1;
}

message GetUserBookingsResponse {
  repeated BookingItem bookings = 1;
}

message CreateReservationRequest {
  string user_id = 1;
  string screening_id = 2;
  repeated SeatInput seats = 3;
  int32 hold_minutes = 4; 
}

message CreateReservationResponse {
  string order_id = 1;        
  repeated string ticket_ids = 2;
  int64 expires_At = 3;      
  int32 amount = 4;      
}

message SeatInput {
  string seat_id = 1;    
  int32 price = 2;     
}

message ConfirmBookingRequest {
  string booking_id = 1;
  string user_id = 2;
}

message ConfirmBookingResponse {
  bool ok = 1;
}

message CancelBookingRequest {
  string booking_id = 1;
  string user_id = 2;
}

message CancelBookingResponse {
  bool ok = 1;
}

message ListReservedSeatsRequest {
  string hall_id = 1;
  string screening_id = 2;
}

message ListReservedSeatsResponse {
  bool ok = 1;
  repeated string reserved_seat_ids = 2;
}

message BookingSeatInfo {
  string id = 1;
  int32 row = 2;
  int32 number = 3;
}

message BookingMovieInfo {
  string id = 1;
  string title = 2;
  string poster = 3;
}

message BookingTheaterInfo {
  string id = 1;
  string name = 2;
}

message BookingHallInfo {
  string id = 1;
  string name = 2;
}

message BookingItem {
  string id = 1;
  string screening_date = 2;
  string screening_time = 3;
  BookingMovieInfo movie = 4;
  BookingTheaterInfo theater = 5;
  BookingHallInfo hall = 6;
  repeated BookingSeatInfo seats = 7;
  string qr_code = 8;
}