syntax = "proto3";

package payment.v1;

service PaymentService {
  rpc CreatePayment (CreatePaymentRequest) returns (CreatePaymentResponse);
  rpc HandleWebhook (WebhookRequest) returns (WebhookResponse);
  
  rpc GetUserPaymentMethods (GetUserPaymentMethodsRequest) returns (GetUserPaymentMethodsResponse);
  rpc CreatePaymentMethod (CreatePaymentMethodRequest) returns (CreatePaymentMethodResponse);
  rpc VerifyPaymentMethod (VerifyPaymentMethodRequest) returns (VerifyPaymentMethodResponse);
  rpc DeletePaymentMethod (DeletePaymentMethodRequest) returns (DeletePaymentMethodResponse);
}

message CreatePaymentRequest {
  int32 amount = 1;
  string description = 2;
  bool savePaymentMethod = 3;
  string bookingId = 4;
  string paymentMethodId = 6;
  string userId = 5;
}

message CreatePaymentResponse {
  string url = 1;  
}

message WebhookRequest {
  string event = 1;
  string paymentId = 2;
  string bookingId = 3;
  string userId = 4;
  bool savePaymentMethod = 5;

  string providerMethodId = 6;
  string cardFirst6 = 7;
  string cardLast4 = 8;
}

message WebhookResponse {
  bool ok = 1;
}

message GetUserPaymentMethodsRequest {
  string userId = 1;
}

message GetUserPaymentMethodsResponse {
  repeated PaymentMethodItem methods = 1;
}

message CreatePaymentMethodRequest {
  string userId = 1;
}

message CreatePaymentMethodResponse {
  string id = 1;
  string url = 2;
}

message VerifyPaymentMethodRequest {
  string userId = 1;
  string methodId = 2;
}

message VerifyPaymentMethodResponse {
  bool ok = 1;
}

message DeletePaymentMethodRequest {
  string userId = 1;
  string methodId = 2;
}

message DeletePaymentMethodResponse {
  bool ok = 1;
}

message PaymentMethodItem {
  string id = 1;
  string bank = 2;
  string brand = 3;
  string first6 = 4;
  string last4 = 5;
}