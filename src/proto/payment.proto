syntax = "proto3";

package payment.v1;

service PaymentService {
  rpc CreatePayment (CreatePaymentRequest) returns (CreatePaymentResponse);
  rpc HandleWebhook (HandleWebhookRequest) returns (HandleWebhookResponse);
  
  rpc GetUserPaymentMethods (GetUserPaymentMethodsRequest) returns (GetUserPaymentMethodsResponse);
  rpc CreatePaymentMethod (CreatePaymentMethodRequest) returns (CreatePaymentMethodResponse);
  rpc VerifyPaymentMethod (VerifyPaymentMethodRequest) returns (VerifyPaymentMethodResponse);
  rpc DeletePaymentMethod (DeletePaymentMethodRequest) returns (DeletePaymentMethodResponse);
}

message CreatePaymentRequest {
  int32 amount = 1;
  string description = 2;
  bool save_payment_method = 3;
  string booking_id = 4;
  string user_id = 5;
  optional string payment_method_id = 6;
}

message CreatePaymentResponse {
  string url = 1;  
}

message HandleWebhookRequest {
  string event = 1;
  string payment_id = 2;
  string booking_id = 3;
  string user_id = 4;
  bool save_payment_method = 5;
  string provider_method_id = 6;
  string card_first6 = 7;
  string card_last4 = 8;
}

message HandleWebhookResponse {
  bool ok = 1;
}

message GetUserPaymentMethodsRequest {
  string user_id = 1;
}

message GetUserPaymentMethodsResponse {
  repeated PaymentMethodItem methods = 1;
}

message CreatePaymentMethodRequest {
  string user_id = 1;
}

message CreatePaymentMethodResponse {
  string id = 1;
  string url = 2;
}

message VerifyPaymentMethodRequest {
  string user_id = 1;
  string method_id = 2;
}

message VerifyPaymentMethodResponse {
  bool ok = 1;
}

message DeletePaymentMethodRequest {
  string user_id = 1;
  string method_id = 2;
}

message DeletePaymentMethodResponse {
  bool ok = 1;
}

message PaymentMethodItem {
  string id = 1;
  string bank = 2;
  string brand = 3;
  string first6 = 4;
  string last4 = 5;
}